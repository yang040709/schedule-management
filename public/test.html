<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>网页通知功能演示</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    header {
      background: linear-gradient(to right, #4b6cb7, #182848);
      color: white;
      padding: 30px;
      text-align: center;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    .content {
      padding: 30px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .card {
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    h2 {
      color: #182848;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    .btn {
      display: inline-block;
      background: #4b6cb7;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background 0.3s;
      margin: 10px 5px;
    }

    .btn:hover {
      background: #3a5ca0;
    }

    .btn-success {
      background: #28a745;
    }

    .btn-success:hover {
      background: #218838;
    }

    .btn-warning {
      background: #ffc107;
      color: #212529;
    }

    .btn-warning:hover {
      background: #e0a800;
    }

    .btn-danger {
      background: #dc3545;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .notification-area {
      margin-top: 20px;
      min-height: 150px;
      border: 1px dashed #ddd;
      border-radius: 8px;
      padding: 15px;
      background-color: #f9f9f9;
    }

    .notification {
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .notification.info {
      background-color: #d1ecf1;
      border-left: 4px solid #17a2b8;
    }

    .notification.success {
      background-color: #d4edda;
      border-left: 4px solid #28a745;
    }

    .notification.warning {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
    }

    .notification.error {
      background-color: #f8d7da;
      border-left: 4px solid #dc3545;
    }

    .notification .close {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #666;
    }

    .status {
      margin: 15px 0;
      padding: 10px;
      border-radius: 6px;
      background-color: #f8f9fa;
    }

    .permission-granted {
      color: #155724;
      background-color: #d4edda;
    }

    .permission-denied {
      color: #721c24;
      background-color: #f8d7da;
    }

    .permission-default {
      color: #856404;
      background-color: #fff3cd;
    }

    footer {
      text-align: center;
      padding: 20px;
      background-color: #f8f9fa;
      color: #6c757d;
      border-top: 1px solid #e9ecef;
    }

    @media (max-width: 768px) {
      .content {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>网页通知功能演示</h1>
      <p class="subtitle">使用Web Notification API和页面内通知实现用户提醒</p>
    </header>

    <div class="content">
      <div class="card">
        <h2>浏览器桌面通知</h2>
        <p>使用Web Notification API实现系统级通知，即使页面在后台也能提醒用户。</p>

        <div class="status" id="permissionStatus">
          通知权限状态: <span id="statusText">检查中...</span>
        </div>

        <button class="btn" id="requestPermission">请求通知权限</button>
        <button class="btn btn-success" id="sendNotification">发送桌面通知</button>
        <button class="btn btn-warning" id="sendInteractiveNotification">发送交互式通知</button>

        <h3 style="margin-top: 20px;">定时通知</h3>
        <button class="btn" id="scheduleNotification">5秒后发送定时通知</button>
      </div>

      <div class="card">
        <h2>页面内通知</h2>
        <p>在页面内显示通知消息，适合不需要打断用户操作的提示。</p>

        <button class="btn btn-success" id="showInfoNotification">信息通知</button>
        <button class="btn btn-warning" id="showWarningNotification">警告通知</button>
        <button class="btn btn-danger" id="showErrorNotification">错误通知</button>
        <button class="btn" id="clearNotifications">清除所有通知</button>

        <div class="notification-area" id="notificationArea">
          <p style="text-align: center; color: #999; padding: 20px;">通知将显示在这里</p>
        </div>
      </div>
    </div>

    <footer>
      <p>Web Notification API 演示 - 使用现代浏览器功能实现用户通知</p>
    </footer>
  </div>

  <script>
    // 检查浏览器是否支持Notification API[1,3](@ref)
    window.addEventListener('DOMContentLoaded', (event) => {
      checkNotificationPermission();

      // 请求通知权限
      document.getElementById('requestPermission').addEventListener('click', () => {
        requestNotificationPermission();
      });

      // 发送简单通知
      document.getElementById('sendNotification').addEventListener('click', () => {
        sendDesktopNotification('新消息提醒', '您有一条新的消息，请查收！', '/icon.png');
      });

      // 发送交互式通知
      document.getElementById('sendInteractiveNotification').addEventListener('click', () => {
        sendInteractiveNotification();
      });

      // 发送定时通知
      document.getElementById('scheduleNotification').addEventListener('click', () => {
        scheduleNotification();
      });

      // 页面内通知按钮
      document.getElementById('showInfoNotification').addEventListener('click', () => {
        showInPageNotification('信息提示', '这是一条信息通知', 'info');
      });

      document.getElementById('showWarningNotification').addEventListener('click', () => {
        showInPageNotification('警告', '这是一条警告通知', 'warning');
      });

      document.getElementById('showErrorNotification').addEventListener('click', () => {
        showInPageNotification('错误', '这是一条错误通知', 'error');
      });

      document.getElementById('clearNotifications').addEventListener('click', () => {
        clearNotifications();
      });
    });

    // 检查通知权限状态[3,7](@ref)
    function checkNotificationPermission() {
      const statusElement = document.getElementById('statusText');
      const statusContainer = document.getElementById('permissionStatus');

      if (!('Notification' in window)) {
        statusElement.textContent = '不支持';
        statusContainer.className = 'status permission-denied';
        return;
      }

      switch (Notification.permission) {
        case 'granted':
          statusElement.textContent = '已授权';
          statusContainer.className = 'status permission-granted';
          break;
        case 'denied':
          statusElement.textContent = '已拒绝';
          statusContainer.className = 'status permission-denied';
          break;
        default:
          statusElement.textContent = '未决定';
          statusContainer.className = 'status permission-default';
          break;
      }
    }

    // 请求通知权限[3,7](@ref)
    function requestNotificationPermission() {
      if (!('Notification' in window)) {
        alert('您的浏览器不支持通知功能');
        return;
      }

      Notification.requestPermission().then(permission => {
        checkNotificationPermission();

        if (permission === 'granted') {
          showInPageNotification('权限已获取', '您现在可以接收桌面通知了', 'success');
        }
      });
    }

    // 发送桌面通知[1,4](@ref)
    function sendDesktopNotification(title, body, icon) {
      if (Notification.permission !== 'granted') {
        alert('请先授权通知权限');
        return;
      }

      const notification = new Notification(title, {
        body: body,
        icon: icon || '/icon.png', // 在实际使用中替换为实际图标路径
        requireInteraction: false // 设置为true可使通知持续显示直到用户交互[10](@ref)
      });

      // 通知点击事件[6](@ref)
      notification.onclick = function () {
        window.focus();
        notification.close();
        showInPageNotification('通知被点击', '您点击了桌面通知', 'info');
      };

      // 通知关闭事件
      notification.onclose = function () {
        console.log('通知已关闭');
      };
    }

    // 发送交互式通知（带动作按钮）[10](@ref)
    function sendInteractiveNotification() {
      if (Notification.permission !== 'granted') {
        alert('请先授权通知权限');
        return;
      }

      // 注意：actions属性在某些浏览器中可能不支持
      const notification = new Notification('交互式通知', {
        body: '这是一个带操作按钮的通知示例',
        icon: '/icon.png',
        requireInteraction: true,
        // actions: [
        //     { action: 'confirm', title: '确认' },
        //     { action: 'cancel', title: '取消' }
        // ]
      });

      notification.onclick = function () {
        window.focus();
        showInPageNotification('通知被点击', '您点击了交互式通知', 'success');
        notification.close();
      };
    }

    // 定时通知[4](@ref)
    function scheduleNotification() {
      showInPageNotification('定时通知已设置', '桌面通知将在5秒后显示', 'info');

      setTimeout(() => {
        if (Notification.permission === 'granted') {
          sendDesktopNotification('定时通知', '这是5秒前设置的定时通知', '/icon.png');
        } else {
          showInPageNotification('权限错误', '无法发送定时通知，请检查通知权限', 'error');
        }
      }, 5000);
    }

    // 显示页面内通知[9,11](@ref)
    function showInPageNotification(title, message, type) {
      const notificationArea = document.getElementById('notificationArea');

      // 如果通知区域显示的是占位文本，清除它
      if (notificationArea.children.length === 1 &&
        notificationArea.children[0].tagName === 'P' &&
        notificationArea.children[0].style.textAlign === 'center') {
        notificationArea.innerHTML = '';
      }

      const notification = document.createElement('div');
      notification.className = `notification ${type}`;

      notification.innerHTML = `
                <div>
                    <strong>${title}</strong>
                    <p style="margin:5px 0 0 0;">${message}</p>
                </div>
                <button class="close">&times;</button>
            `;

      // 添加关闭按钮事件
      notification.querySelector('.close').addEventListener('click', function () {
        notification.style.animation = 'fadeOut 0.5s';
        setTimeout(() => {
          notification.remove();
          if (notificationArea.children.length === 0) {
            notificationArea.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">通知将显示在这里</p>';
          }
        }, 500);
      });

      // 添加淡出动画
      const style = document.createElement('style');
      style.textContent = `
                @keyframes fadeOut {
                    from { opacity: 1; transform: translateY(0); }
                    to { opacity: 0; transform: translateY(10px); }
                }
            `;
      document.head.appendChild(style);

      notificationArea.appendChild(notification);

      // 5秒后自动移除通知（错误通知不自动消失）
      if (type !== 'error') {
        setTimeout(() => {
          if (notification.parentNode) {
            notification.style.animation = 'fadeOut 0.5s';
            setTimeout(() => {
              notification.remove();
              if (notificationArea.children.length === 0) {
                notificationArea.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">通知将显示在这里</p>';
              }
            }, 500);
          }
        }, 5000);
      }
    }

    // 清除所有页面内通知
    function clearNotifications() {
      const notificationArea = document.getElementById('notificationArea');
      notificationArea.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">通知将显示在这里</p>';
    }
  </script>
</body>

</html>